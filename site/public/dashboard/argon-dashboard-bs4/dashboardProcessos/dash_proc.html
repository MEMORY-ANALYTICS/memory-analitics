<!--
=========================================================
* Argon Dashboard - v1.2.0
=========================================================
* Product Page: https://www.creative-tim.com/product/argon-dashboard


* Copyright  Creative Tim (http://www.creative-tim.com)
* Coded by www.creative-tim.com



=========================================================
* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta
      name="description"
      content="Start your development with a Dashboard for Bootstrap 4."
    />
    <meta name="author" content="Creative Tim" />
    <title>Analisar Processos</title>
    <!-- Favicon -->
    <link
      rel="icon"
      href="../../../assets/img/brand/favicon.png"
      type="image/png"
    />
    <!-- Fonts -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700"
    />
    <!-- Icons -->
    <link
      rel="stylesheet"
      href="../../../assets/vendor/nucleo/css/nucleo.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="../../../assets/vendor/@fortawesome/fontawesome-free/css/all.min.css"
      type="text/css"
    />
    <!-- Page plugins -->
    <!-- Argon CSS -->
    <link
      rel="stylesheet"
      href="../../argon-dashboard-bs4/assets/css/argon.css?v=1.2.0"
      type="text/css"
    />
    <link rel="stylesheet" href="style_dashProc.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>

  <body>
    <!-- Sidenav -->

    <nav
      class="sidenav navbar navbar-vertical fixed-left navbar-expand-xs navbar-light bg-white"
      id="sidenav-main"
    >
      <div class="scrollbar-inner">
        <!-- Brand -->
        <div class="sidenav-header align-items-center">
          <a class="navbar-brand" href="" style="padding-left: 2%">
            <img src="../../../../assets/img/logos/logo.png" alt="" />
            <b
              style="
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
              "
              >Memory Analytics</b
            >
          </a>
        </div>
        <div class="navbar-inner">
          <!-- Collapse -->
          <div class="collapse navbar-collapse" id="sidenav-collapse-main">
            <!-- Nav items -->
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link active" href=".././paginaGerente.html">
                  <i class="ni ni-tv-2 text-primary"></i>
                  <span class="nav-link-text" style="padding-left: 5%"
                    >Dashboard</span
                  >
                </a>
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  href="../../argon-dashboard-bs4/funcionario/funcionarios.html"
                >
                  <i class="ni ni-badge text-blue"></i>
                  <span class="nav-link-text" style="padding-left: 5%"
                    >Funcionários</span
                  >
                </a>
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  href="../../argon-dashboard-bs4/server/servers.html"
                >
                  <i class="ni ni-building text-primary"></i>
                  <span class="nav-link-text">Servidores</span>
                </a>
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  href="../../argon-dashboard-bs4/componente/componentes.html"
                >
                  <i class="ni ni-laptop text-blue"></i>
                  <span class="nav-link-text">Componentes</span>
                </a>
              </li>
            </ul>
            <!-- Divider -->
            <hr class="my-3" />
            <!-- Heading -->
            <h6 class="navbar-heading p-0 text-muted">
              <span class="docs-normal">Dashboards Personalizadas</span>
            </h6>
            <!-- Navigation -->
            <ul class="navbar-nav mb-md-3">
              <li class="nav-item">
                <a
                  class="nav-link"
                  href=".././dashboardComponentes/paginaAnalistaHardware.html"
                  target="_blank"
                >
                  <img
                    src="../../../../assets/icons_geral/hardware_icons.png"
                  />
                  <span class="nav-link-text" style="padding-left: 5%"
                    >Hardware</span
                  >
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./dash_proc.html" target="_blank">
                  <img
                    src="../../../../assets/icons_geral/processo_icons.png"
                  />
                  <span class="nav-link-text" style="padding-left: 5%"
                    >Processos</span
                  >
                </a>
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  href=".././dashboardRede/dash_rede.html"
                  target="_blank"
                >
                  <img src="../../../../assets/icons_geral/rede_icons.png" />
                  <span class="nav-link-text" style="padding-left: 5%"
                    >Rede</span
                  >
                </a>
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  href=".././dashboardTemperatura/public/dash_temp.html"
                  target="_blank"
                >
                  <img src="../../../../assets/icons_geral/temp_icons.png" />
                  <span class="nav-link-text" style="padding-left: 5%"
                    >Temperatura</span
                  >
                </a>
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  href=".././dashboardCorrelacoes/dashboardCorrelacoes.html"
                  target="_blank"
                >
                  <img
                    src="../../../../assets/icons_geral/correlacao_icons.png"
                  />
                  <span class="nav-link-text" style="padding-left: 5%"
                    >Correlação</span
                  >
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </nav>
    <!-- Main content -->
    <div class="main-content" id="panel">
      <!-- Topnav -->
      <nav
        class="navbar navbar-top navbar-expand navbar-dark bg-primary border-bottom"
      >
        <div class="container-fluid">
          <div
            class="collapse navbar-collapse"
            id="navbarSupportedContent"
            style="
              display: flex;
              justify-content: space-between;
              position: relative;
            "
          >
            <!--            
            <div style="display: flex; justify-content: space-around; width: 50%;">
              
              <button onclick="menu()">rede</button>
              <button onclick="menu()">disco</button>
              <button onclick="menu()">analytics</button>
              <button onclick="menu()">processos</button>
            </div>
          -->

            <!-- Navbar links -->

            <ul
              class="navbar-nav align-items-center"
              style="display: flex; justify-content: space-between"
            >
              <li class="nav-item d-sm-none">
                <a
                  class="nav-link"
                  href="#"
                  data-action="search-show"
                  data-target="#navbar-search-main"
                >
                  <i class="ni ni-zoom-split-in"></i>
                </a>
              </li>
              <li>
                <div
                  class="sidenav-toggler-inner sidenav-toggler-dark"
                  style="cursor: pointer; justify-content: start"
                  onclick="menu()"
                >
                  <i class="sidenav-toggler-line"></i>
                  <i class="sidenav-toggler-line"></i>
                  <i class="sidenav-toggler-line"></i>
                </div>
              </li>

              <li>
                <!--Notification_icon-->
                <a
                  id="notification"
                  class="nav-link"
                  style="cursor: pointer"
                  onmouseover="notification()"
                  onmouseleave="notification_of()"
                  onclick=""
                >
                  <i class="ni ni-bell-55"></i>
                </a>

                <div id="container_notification" style="display: none">
                  <!-- Dropdown header -->
                  <div class="px-3 py-3">
                    <h6 class="text-sm text-muted m-0">
                      You have
                      <strong class="text-primary">13</strong> notifications.
                    </h6>
                  </div>
                  <!-- List group -->
                  <div class="list-group list-group-flush">
                    <a href="#!" class="list-group-item list-group-item-action">
                      <div class="row align-items-center">
                        <div class="col-auto">
                          <!-- Avatar -->
                          <img
                            alt="Image placeholder"
                            src="../assets/img/theme/team-1.jpg"
                            class="avatar rounded-circle"
                          />
                        </div>
                        <div class="col ml--2">
                          <div
                            class="d-flex justify-content-between align-items-center"
                          >
                            <div>
                              <h4 class="mb-0 text-sm"></h4>
                            </div>
                            <div class="text-right text-muted">
                              <small>2 hrs ago</small>
                            </div>
                          </div>
                          <p class="text-sm mb-0">
                            Let's meet at Starbucks at 11:30. Wdyt?
                          </p>
                        </div>
                      </div>
                    </a>
                    <a href="#!" class="list-group-item list-group-item-action">
                      <div class="row align-items-center">
                        <div class="col-auto">
                          <!-- Avatar -->
                          <img
                            alt="Image placeholder"
                            src="../assets/img/theme/team-2.jpg"
                            class="avatar rounded-circle"
                          />
                        </div>
                        <div class="col ml--2">
                          <div
                            class="d-flex justify-content-between align-items-center"
                          >
                            <div>
                              <h4 class="mb-0 text-sm">Ana Fonseca</h4>
                            </div>
                            <div class="text-right text-muted">
                              <small>3 hrs ago</small>
                            </div>
                          </div>
                          <p class="text-sm mb-0">
                            A new issue has been reported for Argon.
                          </p>
                        </div>
                      </div>
                    </a>
                    <a href="#!" class="list-group-item list-group-item-action">
                      <div class="row align-items-center">
                        <div class="col-auto">
                          <!-- Avatar -->
                          <img
                            alt="Image placeholder"
                            src="../assets/img/theme/team-3.jpg"
                            class="avatar rounded-circle"
                          />
                        </div>
                        <div class="col ml--2">
                          <div
                            class="d-flex justify-content-between align-items-center"
                          >
                            <div>
                              <h4 class="mb-0 text-sm">Ana Fonseca</h4>
                            </div>
                            <div class="text-right text-muted">
                              <small>5 hrs ago</small>
                            </div>
                          </div>
                          <p class="text-sm mb-0">
                            Your posts have been liked a lot.
                          </p>
                        </div>
                      </div>
                    </a>
                    <a href="#!" class="list-group-item list-group-item-action">
                      <div class="row align-items-center">
                        <div class="col-auto">
                          <!-- Avatar -->
                          <img
                            alt="Image placeholder"
                            src="../assets/img/theme/team-4.jpg"
                            class="avatar rounded-circle"
                          />
                        </div>
                        <div class="col ml--2">
                          <div
                            class="d-flex justify-content-between align-items-center"
                          >
                            <div>
                              <h4 class="mb-0 text-sm">Ana Fonseca</h4>
                            </div>
                            <div class="text-right text-muted">
                              <small>2 hrs ago</small>
                            </div>
                          </div>
                          <p class="text-sm mb-0">
                            Let's meet at Starbucks at 11:30. Wdyt?
                          </p>
                        </div>
                      </div>
                    </a>
                    <a href="#!" class="list-group-item list-group-item-action">
                      <div class="row align-items-center">
                        <div class="col-auto">
                          <!-- Avatar -->
                          <img
                            alt="Image placeholder"
                            src="../assets/img/theme/team-5.jpg"
                            class="avatar rounded-circle"
                          />
                        </div>
                        <div class="col ml--2">
                          <div
                            class="d-flex justify-content-between align-items-center"
                          >
                            <div>
                              <h4 class="mb-0 text-sm">Ana Fonseca</h4>
                            </div>
                            <div class="text-right text-muted">
                              <small>3 hrs ago</small>
                            </div>
                          </div>
                          <p class="text-sm mb-0">
                            A new issue has been reported for Argon.
                          </p>
                        </div>
                      </div>
                    </a>
                  </div>
                  <!-- View all -->
                  <a
                    href="#!"
                    class="dropdown-item text-center text-primary font-weight-bold py-3"
                    >View all</a
                  >
                </div>
              </li>
              <li class="nav-item dropdown">
                <!--
                
                <a class="nav-link" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false">
                <i class="ni ni-ungroup"></i>
              </a>
              <div class="dropdown-menu dropdown-menu-lg dropdown-menu-dark bg-default  dropdown-menu-right ">
                <div class="row shortcuts px-4">
                  <a href="#!" class="col-4 shortcut-item">
                    <span class="shortcut-media avatar rounded-circle bg-gradient-red">
                      <i class="ni ni-calendar-grid-58"></i>
                    </span>
                    <small>Calendar</small>
                  </a>
                  <a href="#!" class="col-4 shortcut-item">
                    <span class="shortcut-media avatar rounded-circle bg-gradient-orange">
                      <i class="ni ni-email-83"></i>
                    </span>
                    <small>Email</small>
                  </a>
                  <a href="#!" class="col-4 shortcut-item">
                    <span class="shortcut-media avatar rounded-circle bg-gradient-info">
                      <i class="ni ni-credit-card"></i>
                    </span>
                    <small>Payments</small>
                  </a>
                  <a href="#!" class="col-4 shortcut-item">
                    <span class="shortcut-media avatar rounded-circle bg-gradient-green">
                      <i class="ni ni-books"></i>
                    </span>
                    <small>Reports</small>
                  </a>
                  <a href="#!" class="col-4 shortcut-item">
                    <span class="shortcut-media avatar rounded-circle bg-gradient-purple">
                      <i class="ni ni-pin-3"></i>
                    </span>
                    <small>Maps</small>
                  </a>
                  <a href="#!" class="col-4 shortcut-item">
                    <span class="shortcut-media avatar rounded-circle bg-gradient-yellow">
                      <i class="ni ni-basket"></i>
                    </span>
                    <small>Shop</small>
                  </a>
                </div>
              </div>
            -->
              </li>
            </ul>
            <ul class="navbar-nav align-items-center ml-auto ml-md-0">
              <li class="nav-item dropdown">
                <a
                  class="nav-link pr-0"
                  href="#"
                  role="button"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="false"
                >
                  <div class="media align-items-center">
                    <span class="avatar avatar-sm rounded-circle">
                      <img
                        alt="Image placeholder"
                        src="../assets/img/theme/team-4.jpg"
                      />
                    </span>
                    <div class="media-body ml-2 d-none d-lg-block">
                      <span
                        class="mb-0 text-sm font-weight-bold"
                        id="nomeProto"
                      ></span>
                    </div>
                  </div>
                </a>
                <div class="dropdown-menu dropdown-menu-right">
                  <div class="dropdown-header noti-title">
                    <h6 class="text-overflow m-0">Welcome!</h6>
                  </div>
                  <a href="#!" class="dropdown-item">
                    <i class="ni ni-single-02"></i>
                    <span>My profile</span>
                  </a>
                  <a href="#!" class="dropdown-item">
                    <i class="ni ni-settings-gear-65"></i>
                    <span>Settings</span>
                  </a>
                  <a href="#!" class="dropdown-item">
                    <i class="ni ni-calendar-grid-58"></i>
                    <span>Activity</span>
                  </a>
                  <a href="#!" class="dropdown-item">
                    <i class="ni ni-support-16"></i>
                    <span>Support</span>
                  </a>
                  <div class="dropdown-divider"></div>
                  <a href="#!" class="dropdown-item">
                    <i class="ni ni-user-run"></i>
                    <span>Logout</span>
                  </a>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <!-- Header -->

      <!-- Header -->
      <div
        class="modal fade bd-example-modal-xl"
        id="exampleModalCenterAdicionar"
        tabindex="-1"
        role="dialog"
        aria-labelledby="exampleModalCenterTitle"
        aria-hidden="true"
      >
        <div
          class="modal-dialog modal-dialog-centered modal-xl"
          role="document"
        >
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLongTitle">
                Adicionar Processo
              </h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="w-100" id="cadastro_processo">
                <div class="w-100 row mx-1">
                  <div class="form-group col-xl-12">
                    <label for="nome_processo">NOME DO PROCESSO</label>
                    <input
                      type="text"
                      class="form-control"
                      id="nome_processo"
                      placeholder="discord"
                    />
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-dismiss="modal"
              >
                Fechar
              </button>
              <button
                onclick="cadastrarProcesso()"
                type="button"
                class="btn btn-primary"
              >
                Salvar mudanças
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="header bg-primary pb-6">
        <div class="container-fluid">
          <div class="header-body">
            <div class="row align-items-center py-4">
              <div class="col-xl-12">
                <div class="row">
                  <div
                    class="form-group col-xl-3 py-2 bg bg-white rounded mr-2"
                    style="box-shadow: 0.3em 0.3em 1em rgba(65, 58, 58, 0.6)"
                  >
                    <div class="col-xl-12">
                      <div class="row">
                        <div
                          class="col-xl-6 d-flex justify-content-center align-middle"
                        >
                          <p class="h2 text-center">Servidor Visualizado:</p>
                        </div>
                        <div class="col-xl-6 py-2">
                          <select
                            class="form-control text-primary border-0"
                            style="
                              font-size: 1.2em;
                              text-align: center;
                              box-shadow: 0.1em 0.1em 0.5em
                                rgba(92, 85, 85, 0.6);
                            "
                            id="selectServer"
                          >
                            <option disabled selected>
                              Selecione o Servidor
                            </option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Card stats -->
              <div class="row">
                <div class="col-xl-3 col-md-6">
                  <div class="card card-stats" style="height: 70%">
                    <!-- Card body -->
                    <div
                      class="card-body"
                      style="box-shadow: 0.3em 0.3em 1em rgba(65, 58, 58, 0.6)"
                    >
                      <div class="row">
                        <div class="col">
                          <h5 class="card-title text-uppercase text-muted mb-0">
                            Utilizacao de ram pelos processos
                          </h5>
                          <span id="usoRam" class="h2 font-weight-bold mb-0"
                            >54%</span
                          >
                        </div>
                        <div class="col-auto">
                          <div
                            class="icon icon-shape bg-gradient-info text-white rounded-circle shadow"
                          >
                            <img
                              src="../../../assets/icons_geral/verificado_icons.png"
                              alt=""
                            />
                          </div>
                        </div>
                      </div>
                      <p class="mt-3 mb-0 text-sm">
                        <span>Estável</span>
                      </p>
                    </div>
                  </div>
                </div>

                <div class="col-xl-3 col-md-6">
                  <div class="card card-stats" style="height: 70%">
                    <!-- Card body -->
                    <div
                      class="card-body"
                      style="box-shadow: 0.3em 0.3em 1em rgba(65, 58, 58, 0.6)"
                    >
                      <div class="row">
                        <div class="col">
                          <h5 class="card-title text-uppercase text-muted mb-0">
                            Utilização de CPU pelos processos
                          </h5>
                          <span id="usoCpu" class="h2 font-weight-bold mb-0"
                            >53%</span
                          >
                        </div>
                        <div class="col-auto">
                          <div
                            class="icon icon-shape bg-gradient-red text-white rounded-circle shadow"
                          >
                            <img
                              src="../../../assets/icons_geral/dash_icons.png"
                              alt=""
                            />
                          </div>
                        </div>
                      </div>
                      <p class="mt-3 pb-3 text-sm">
                        <!--
                      <span class="text-success mr-2"><i class="fa fa-arrow-up"></i> 3.48%</span>
                    -->
                      </p>
                    </div>
                  </div>
                </div>
                <div class="col-xl-3 col-md-6">
                  <div class="card card-stats" style="height: 70%">
                    <!-- Card body -->
                    <div
                      class="card-body"
                      style="box-shadow: 0.3em 0.3em 1em rgba(65, 58, 58, 0.6)"
                    >
                      <div class="row">
                        <div class="col">
                          <h5 class="card-title text-uppercase text-muted mb-0">
                            Processo que mais gasta recursos
                          </h5>
                          <span
                            id="processoMaisGasta"
                            class="h2 font-weight-bold mb-0"
                            >chrome.exe</span
                          >
                        </div>
                        <div class="col-auto">
                          <div
                            class="icon icon-shape bg-gradient-orange text-white rounded-circle shadow"
                          >
                            <img
                              src="../../../assets/icons_geral/fire_icon.png"
                              alt=""
                            />
                          </div>
                        </div>
                      </div>
                      <p class="mt-3 mb-0 text-sm">
                        <!--
                      <span class="text-success mr-2"><i class="fa fa-arrow-up"></i> 3.48%</span>
                    -->
                      </p>
                    </div>
                  </div>
                </div>
                <div class="col-xl-3 col-md-6">
                  <div class="card card-stats" style="height: 70%">
                    <!-- Card body -->
                    <div
                      class="card-body"
                      style="box-shadow: 0.3em 0.3em 1em rgba(65, 58, 58, 0.6)"
                    >
                      <div class="row">
                        <div class="col">
                          <h5 class="card-title text-uppercase text-muted mb-0">
                            Quantidade de processos bloqueados:
                          </h5>
                          <span
                            id="qtdProcessosBloqueados"
                            class="h2 font-weight-bold mb-0"
                            >5</span
                          >
                        </div>
                        <div class="col-auto">
                          <div
                            class="icon icon-shape bg-gradient-green text-white rounded-circle shadow"
                          >
                            <img
                              src="../../../assets/icons_geral/snow_icon.png"
                              alt=""
                            />
                          </div>
                        </div>
                      </div>
                      <p class="mt-3 mb-0 text-sm">
                        <!--
                      <span class="text-success mr-2"><i class="fa fa-arrow-up"></i> 3.48%</span>
                    -->
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Page content -->
        <div class="container-fluid mt--6">
          <div class="row mb-4" style="background-color: white">
            <div class="col-xl-12">
              <p>
                Quantidade de Processos Online:
                <span id="qtdProcessosOnline">3</span>
              </p>
              <div style="height: 50vh" class="">
                <canvas id="myChart"></canvas>
              </div>
              <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            </div>
          </div>
        </div>
        <div class="container-fluid">
          <div class="table-responsive" style="background-color: white">
            <div class="d-flex justify-content-between m-4">
              <div>
                <p>Processos Banidos:</p>
              </div>
              <a
                class="btn"
                style="box-shadow: 1px 1px 15px gray"
                data-toggle="modal"
                data-target="#exampleModalCenterAdicionar"
                >+</a
              >
            </div>

            <!-- Projects table -->
            <table class="table align-items-center table-flush">
              <thead class="thead-light">
                <tr>
                  <th style="width: auto; text-align: center">Processo</th>
                  <th style="width: auto; text-align: center">Ações</th>
                </tr>
              </thead>
              <tbody id="tableProcessos"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <!-- Argon Scripts -->
    <!-- Core -->
    <script src="../assets/vendor/jquery/dist/jquery.min.js"></script>
    <script src="../assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../assets/vendor/js-cookie/js.cookie.js"></script>
    <script src="../assets/vendor/jquery.scrollbar/jquery.scrollbar.min.js"></script>
    <script src="../assets/vendor/jquery-scroll-lock/dist/jquery-scrollLock.min.js"></script>
    <!-- Optional JS -->
    <script src="../assets/vendor/chart.js/dist/Chart.min.js"></script>
    <script src="../assets/vendor/chart.js/dist/Chart.extension.js"></script>
    <!-- Argon JS -->
    <script src="../assets/js/argon.js?v=1.2.0"></script>
  </body>
  <script>
    var myChart2;
    var myChart;
    nomeProto.innerHTML = sessionStorage.getItem("NOME_USUARIO");
    let proximaAtualizacao;
    obterDadosGrafico(4);
    const ctx = document.getElementById("myChart");

    if (myChart != undefined) {
      myChart.destroy();
    }
    if(myChart2 != undefined){
      myChart2.destroy();
    }
    myChart = new Chart(ctx, {});

    function obterDadosGrafico(fkServidor) {
      if (proximaAtualizacao != undefined) {
        clearTimeout(proximaAtualizacao);
      }

      fetch(`/processos/ultimas/${fkServidor}`, { cache: "no-store" })
        .then(function (response) {
          if (response.ok) {
            response.json().then(function (resposta) {
              console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
              resposta.reverse();
              processoMaisGasta.innerHTML = resposta[resposta.length - 1].pmmu;
              usoCpu.innerHTML = resposta[resposta.length - 1].cpu + "%";
              usoRam.innerHTML = resposta[resposta.length - 1].ram + "%";
              qtdProcessosOnline.innerHTML =
                resposta[resposta.length - 1].qtdProcessosOnline;
              plotarGrafico(resposta, fkServidor);
            });
          } else {
            console.error("Nenhum dado encontrado ou erro na API");
          }
        })
        .catch(function (error) {
          console.error(
            `Erro na obtenção dos dados p/ gráfico: ${error.message}`
          );
        });
    }

    // Esta função *plotarGrafico* usa os dados capturados na função anterior para criar o gráfico
    // Configura o gráfico (cores, tipo, etc), materializa-o na página e,
    // A função *plotarGrafico* também invoca a função *atualizarGrafico*
    function plotarGrafico(resposta, fkServidor) {
      console.log("iniciando plotagem do gráfico...");

      // Criando estrutura para plotar gráfico - labels
      let labels = [];

      // Criando estrutura para plotar gráfico - dados
      let dados = {
        labels: labels,
        datasets: [
          {
            label: "CPU",
            data: [],
            fill: true,
            borderColor: "rgb(75, 192, 192)",
            tension: 0.1,
          },
          {
            label: "RAM",
            data: [],
            fill: true,
            borderColor: "rgb(199, 52, 52)",
            tension: 0.1,
          },
        ],
      };

      console.log("----------------------------------------------");
      console.log(
        'Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":'
      );
      console.log(resposta);

      // Inserindo valores recebidos em estrutura para plotar o gráfico
      for (i = 0; i < resposta.length; i++) {
        var registro = resposta[i];
        labels.push(registro.momento_grafico);
        dados.datasets[0].data.push(registro.cpu);
        dados.datasets[1].data.push(registro.ram);
      }

      console.log("----------------------------------------------");
      console.log("O gráfico será plotado com os respectivos valores:");
      console.log("Labels:");
      console.log(labels);
      console.log("Dados:");
      console.log(dados.datasets);
      console.log("----------------------------------------------");

      // Criando estrutura para plotar gráfico - config
      const config = {
        type: "line",
        data: dados,
      };

      // Adicionando gráfico criado em div na tela
      myChart2 = new Chart(document.getElementById(`myChart`), config);
      setTimeout(() => atualizarGrafico(4, dados, myChart2), 10000);
    }

    function atualizarGrafico(fkServer, dados, myChart) {
      fetch(`/processos/tempo-real/${fkServer}`, { cache: "no-store" })
        .then(function (response) {
          if (response.ok) {
            response.json().then(function (novoRegistro) {
              obterDadosGrafico(fkServer);
              // alertar(novoRegistro, fkServer);
              console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
              console.log(`Dados atuais do gráfico:`);
              console.log(dados);
              usoCpu.innerHTML = novoRegistro[0].cpu + "%";
              usoRam.innerHTML = novoRegistro[0].ram + "%";
              qtdProcessosOnline.innerHTML = novoRegistro[0].qtdProcessosOnline;
              let avisoCaptura = document.getElementById(
                `avisoCaptura${fkServer}`
              );
              avisoCaptura.innerHTML = "";

              if (
                novoRegistro[0].momento_grafico ==
                dados.labels[dados.labels.length - 1]
              ) {
                console.log(
                  "---------------------------------------------------------------"
                );
                console.log(
                  "Como não há dados novos para captura, o gráfico não atualizará."
                );
                console.log("Horário do novo dado capturado:");
                console.log(novoRegistro[0].momento_grafico);
                console.log("Horário do último dado capturado:");
                console.log(dados.labels[dados.labels.length - 1]);
                console.log(
                  "---------------------------------------------------------------"
                );
              } else {
                // tirando e colocando valores no gráfico
                dados.labels.shift(); // apagar o primeiro
                dados.labels.push(novoRegistro[0].momento_grafico); // incluir um novo momento

                dados.datasets[0].data.shift(); // apagar o primeiro de umidade
                dados.datasets[0].data.push(novoRegistro[0].cpu); // incluir uma nova medida de umidade

                dados.datasets[1].data.shift(); // apagar o primeiro de temperatura
                dados.datasets[1].data.push(novoRegistro[0].ram); // incluir uma nova medida de temperatura
                myChart.destroy();
                myChart.update();
              }
            });
          } else {
            console.error("Nenhum dado encontrado ou erro na API");
            // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
            proximaAtualizacao = setTimeout(
              () => atualizarGrafico(fkServer, dados, myChart),
              10000
            );
          }
        })
        .catch(function (error) {
          console.error(
            `Erro na obtenção dos dados p/ gráfico: ${error.message}`
          );
        });
    }

    getAllProcessosBanidos(4);
    function getAllProcessosBanidos(fkServer) {
      tableProcessos.innerHTML = "";
      fetch(`/processos/getAllProcessosBanidos/${fkServer}`, {
        cache: "no-store",
      })
        .then(function (response) {
          if (response.ok) {
            response.json().then(function (resposta) {
              for (i = 0; i < resposta.length; i++) {
                tableProcessos.innerHTML += `
                    <tr>
                      <td style="width: auto; text-align: center">
                        ${resposta[i].nomeProcesso}
                      </td>
                      <td style="width: auto; text-align: center;cursor:pointer;">
                        <p onclick="deleteProcesso(${resposta[i].idProcesso})">X</p>
                     </td>
                  </tr>
                  `;
              }
            });
          } else {
            console.error("Nenhum dado encontrado ou erro na API");
          }
        })
        .catch(function (error) {
          console.error(
            `Erro na obtenção dos dados p/ tabela: ${error.message}`
          );
        });
    }

    setInterval(() => {
      getQtdProcessosBanidos(4);
    }, 10000);
    function getQtdProcessosBanidos(fkServer) {
      fetch(`/processos/getQtdProcessosBanidos/${fkServer}`, {
        cache: "no-store",
      })
        .then(function (response) {
          if (response.ok) {
            response.json().then(function (resposta) {
              qtdProcessosBloqueados.innerHTML = resposta[0].qtdProcessos;
            });
          } else {
            console.error("Nenhum dado encontrado ou erro na API");
          }
        })
        .catch(function (error) {
          console.error(
            `Erro na obtenção dos dados p/ tabela: ${error.message}`
          );
        });
    }

    getAllServers(sessionStorage.getItem("EMPRESA_USUARIO"));

    function getAllServers(fkEmpresa) {
      console.log(fkEmpresa);
      fetch(`/servidor/getAll/${fkEmpresa}`)
        .then(function (response) {
          if (response.ok) {
            response.json().then(function (resposta) {
              console.log(`Dados recebidos: ${JSON.stringify(resposta[0])}`);
              for (i = 0; i < resposta.length; i++) {
                select = document.getElementById("selectServer");
                select.innerHTML += `<option>${resposta[0]} </option>`;
              }
            });
          } else {
            console.error("Nenhum dado encontrado ou erro na API");
          }
        })
        .catch(function (error) {
          console.error(
            `Erro na obtenção dos dados p/ Usuario: ${error.message}`
          );
        });
    }

    function cadastrarProcesso(fkServidor) {
      var erro = false;
      var nomeProcessoVar = nome_processo.value;
      fkServidor = 4;

      if (nomeProcesso == "") {
        nome_processo.style = "border-color: red !important";
        erro = true;
      }
      if (!erro) {
        fetch(`/processos/adicionarProcesso`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            nomeProcesso: nomeProcessoVar,
            fkServidor: fkServidor,
          }),
        })
          .then(function (resposta) {
            console.log("resposta: ", resposta);

            if (resposta.ok) {
              alert("Cadastrado com sucesso!");
              tableProcessos.innerHTML = "";
              getAllProcessosBanidos(fkServidor);
            } else {
              throw alert(
                "Houve um erro ao tentar realizar o cadastro do processo!"
              );
            }
          })
          .catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
          });
      } else {
        alert("Houve um erro ao tentar realizar o cadastro do Processo!");
      }
    }

    function deleteProcesso(idProcesso) {
      Swal.fire({
        title: "Deseja realmente deletar este processo?",
        showDenyButton: false,
        showCancelButton: true,
        confirmButtonText: "Deletar",
        denyButtonText: `Don't save`,
      }).then((result) => {
        /* Read more about isConfirmed, isDenied below */
        if (result.isConfirmed) {
          let erro = false;

          if (idProcesso == null || idProcesso == undefined) {
            erro = true;
          }
          if (!erro) {
            fetch(`/processos/deleteProcesso/${idProcesso}`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
            })
              .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                  Swal.fire("Funcionário Deletado com sucesso!", "", "success");
                  deleteFuncionario(idProcesso);
                  tableFuncionarios.innerHTML = "";
                  getAllProcessosBanidos(4);
                } else {
                }
              })
              .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
              });
          }
        } else if (result.isDenied) {
          Swal.fire("Mudanças não efetuadas!", "", "info");
        }
      });
    }
  </script>
</html>
